<!DOCTYPE HTML>
<html>
    <head>
        <meta name="viewport" content="width=device-width, user-scalable=no">
        <style>
            body {
                overflow: hidden; /* Empêche le scroll de la page */
            }
        </style>
    </head>
    <script src="https://aframe.io/releases/0.9.0/aframe.min.js"></script>
    <script src="https://rawgit.com/jeromeetienne/AR.js/master/aframe/build/aframe-ar.min.js"></script>

    <body>
        <a-scene embedded arjs="sourceType: webcam;">
            
            <a-assets>
                <img id="custom-image" src="https://upload.wikimedia.org/wikipedia/commons/3/3f/JPEG_example_flower.jpg">
            </a-assets>

            <a-entity id="floating-image"
                      geometry="primitive: plane; height: 1; width: 1"
                      material="src: #custom-image"
                      position="0 1 -2"
                      scale="1 1 1">
            </a-entity>

            <a-entity camera></a-entity>
        </a-scene>

        <script>
            let img = document.querySelector("#floating-image");
            let scaleFactor = 1;
            let position = { x: 0, y: 1, z: -2 }; // Position initiale
            let initialDistance = null;
            let lastTouch = null;

            // Zoom avec la molette de la souris
            window.addEventListener("wheel", (event) => {
                scaleFactor += event.deltaY > 0 ? -0.1 : 0.1;
                scaleFactor = Math.max(0.5, 3); // Limiter le zoom
                img.setAttribute("scale", `${scaleFactor} ${scaleFactor} ${scaleFactor}`);
            });

            // Déplacement avec un doigt, zoom avec deux doigts
            window.addEventListener("touchstart", (event) => {
                if (event.touches.length === 2) {
                    // Pinch-to-zoom
                    initialDistance = Math.hypot(
                        event.touches[0].pageX - event.touches[1].pageX,
                        event.touches[0].pageY - event.touches[1].pageY
                    );
                } else if (event.touches.length === 1) {
                    // Déplacement de l'image
                    lastTouch = { x: event.touches[0].pageX, y: event.touches[0].pageY };
                }
            });

            window.addEventListener("touchmove", (event) => {
                if (event.touches.length === 2 && initialDistance) {
                    // Gérer le zoom avec deux doigts
                    let newDistance = Math.hypot(
                        event.touches[0].pageX - event.touches[1].pageX,
                        event.touches[0].pageY - event.touches[1].pageY
                    );

                    let zoomFactor = newDistance / initialDistance;
                    scaleFactor *= zoomFactor;
                    scaleFactor = Math.max(0.5, 3);
                    img.setAttribute("scale", `${scaleFactor} ${scaleFactor} ${scaleFactor}`);

                    initialDistance = newDistance;
                } else if (event.touches.length === 1 && lastTouch) {
                    // Déplacement avec un doigt
                    let dx = (event.touches[0].pageX - lastTouch.x) * 0.01;
                    let dy = (event.touches[0].pageY - lastTouch.y) * -0.01;

                    position.x += dx;
                    position.y += dy;
                    img.setAttribute("position", `${position.x} ${position.y} ${position.z}`);

                    lastTouch = { x: event.touches[0].pageX, y: event.touches[0].pageY };
                }
            });

            window.addEventListener("touchend", () => {
                initialDistance = null;
                lastTouch = null;
            });
        </script>
    </body>
</html>
