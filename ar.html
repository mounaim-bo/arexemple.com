<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
  </head>
  <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
  <script src="https://rawgit.com/jeromeetienne/AR.js/master/aframe/build/aframe-ar.min.js"></script>

  <body style='margin: 0px; overflow: hidden;'>
    <a-scene embedded arjs='sourceType: webcam; debugUIEnabled: false;'>

      <a-assets>
        <img id="image-texture" src="https://upload.wikimedia.org/wikipedia/commons/3/3f/JPEG_example_flower.jpg">
      </a-assets>

      <!-- Image en AR qu'on peut déplacer -->
      <a-plane id="draggable-image"
               src="#image-texture"
               position="0 0 -2"
               width="1"
               height="1"
               gesture-handler>
      </a-plane>

      <a-entity camera></a-entity>
    </a-scene>

    <script>
      AFRAME.registerComponent('gesture-handler', {
        init: function () {
          let el = this.el;
          let dragging = false;
          let startX, startY;

          // Commence à déplacer quand on touche/clic
          el.addEventListener('mousedown', function (event) {
            dragging = true;
            startX = event.clientX;
            startY = event.clientY;
          });

          // Déplacement
          window.addEventListener('mousemove', function (event) {
            if (!dragging) return;

            let deltaX = (event.clientX - startX) / window.innerWidth * 2;
            let deltaY = -(event.clientY - startY) / window.innerHeight * 2;

            let pos = el.getAttribute('position');
            el.setAttribute('position', {
              x: pos.x + deltaX,
              y: pos.y + deltaY,
              z: pos.z
            });

            startX = event.clientX;
            startY = event.clientY;
          });

          // Arrête le déplacement quand on relâche
          window.addEventListener('mouseup', function () {
            dragging = false;
          });
        }
      });
    </script>
  </body>
</html>
